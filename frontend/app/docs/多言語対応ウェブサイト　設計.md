S3 \+ CloudFront を使用した Next.js (App Router) SSG 多言語サイトの完全な設計書を作成しました。この設計は、SEO、メンテナンス性、および配信パフォーマンスを最大化するように構成されています。

## ---

**1\. システム全体図**

ユーザーがルートにアクセスした際、JavaScript による言語判定を行い、適切なサブパス（/ja/, /en/）へ誘導します。各言語のページはビルド時に完全に静的な HTML として生成されます。

## ---

**2\. プロジェクト構造 (App Router)**

\[locale\] 動的セグメントを利用し、全ページをその配下に配置します。

Plaintext

.  
├── messages/              \# 翻訳ファイル (JSON)  
│   ├── ja.json  
│   └── en.json  
├── src/  
│   ├── app/  
│   │   ├── \[locale\]/      \# 多言語対応のメインディレクトリ  
│   │   │   ├── layout.tsx \# 共通レイアウト (lang属性, hreflang設定)  
│   │   │   ├── page.tsx   \# 各言語のトップページ  
│   │   │   └── about/  
│   │   │       └── page.tsx  
│   │   ├── layout.tsx     \# ルートレイアウト (基本空)  
│   │   └── page.tsx       \# ルートの index.html (JSリダイレクト用)  
│   ├── components/        \# 共通コンポーネント  
│   ├── i18n.ts            \# next-intl 設定  
│   └── navigation.ts      \# 型安全なリンク管理  
├── next.config.js         \# output: 'export' 等の設定  
└── sitemap.ts             \# サイトマップ生成

## ---

**3\. 主要なコード実装**

### **① next.config.js**

静的エクスポートを有効にし、S3 での参照を容易にするために trailingSlash を有効にします。

JavaScript

/\*\* @type {import('next').NextConfig} \*/  
const nextConfig \= {  
  output: 'export',  
  trailingSlash: true, // /ja/about/index.html 形式で出力され、S3との相性が向上  
  images: { unoptimized: true }, // SSGでは画像の最適化サーバーが使えないため  
};

const withNextIntl \= require('next-intl/plugin')();  
module.exports \= withNextIntl(nextConfig);

### **② src/app/page.tsx (ルートのリダイレクト)**

out/index.html として出力されるファイルです。方法B（JavaScriptリダイレクト）を実装します。

TypeScript

'use client';  
import { useEffect } from 'react';

export default function RootPage() {  
  useEffect(() \=\> {  
    const lang \= navigator.language.split('-')\[0\];  
    const supportedLocales \= \['ja', 'en'\];  
    const target \= supportedLocales.includes(lang) ? lang : 'en'; // デフォルトはen  
    window.location.replace(\`/${target}/\`);  
  }, \[\]);

  return (  
    \<html\>  
      \<head\>  
        \<meta name="robots" content="noindex, follow" /\>  
        \<noscript\>\<meta http-equiv="refresh" content="0; url=/en/" /\>\</noscript\>  
      \</head\>  
      \<body style={{ backgroundColor: '\#fff' }} /\>  
    \</html\>  
  );  
}

### **③ src/app/\[locale\]/layout.tsx (SEO & メタデータ)**

hreflang を動的に生成し、検索エンジンに多言語構成を伝えます。

TypeScript

import { getMessages, unstable\_setRequestLocale } from 'next-intl/server';  
import { ReactNode } from 'react';

const locales \= \['ja', 'en'\];

export function generateStaticParams() {  
  return locales.map((locale) \=\> ({ locale }));  
}

export async function generateMetadata({ params: { locale } }) {  
  const domain \= 'https://example.com';  
  return {  
    alternates: {  
      canonical: \`${domain}/${locale}/\`,  
      languages: {  
        ja: \`${domain}/ja/\`,  
        en: \`${domain}/en/\`,  
        'x-default': \`${domain}/en/\`,  
      },  
    },  
  };  
}

export default async function LocaleLayout({  
  children,  
  params: { locale }  
}: {  
  children: ReactNode;  
  params: { locale: string };  
}) {  
  unstable\_setRequestLocale(locale);  
  return (  
    \<html lang={locale}\>  
      \<body\>{children}\</body\>  
    \</html\>  
  );  
}

## ---

**4\. インフラ設計 (CloudFront \+ S3)**

### **S3 バケット設定**

* **静的ウェブサイトホスティング:** 無効（セキュリティのため OAC を使用）。  
* **パブリックアクセス:** すべてブロック。

### **CloudFront 設定**

| 設定項目 | 値 | 理由 |
| :---- | :---- | :---- |
| **Origin** | S3 バケット (OAC) | 直接 S3 へのアクセスを遮断 |
| **Default Root Object** | index.html | example.com/ へのアクセスを /index.html へ |
| **Viewer Protocol Policy** | Redirect HTTP to HTTPS | セキュリティ |
| **Error Pages** | 404 → /en/index.html (200) | SPA的な振る舞いやフォールバックのため |

**重要:** next.config.js で trailingSlash: true を設定しているため、CloudFront 側で複雑なディレクトリ補完（関数）を作成しなくても、S3 上の /ja/index.html などを正しく参照できるようになります。

## ---

**5\. SEO・運用チェックリスト**

1. **sitemap.xml:** app/sitemap.ts を作成し、全言語のパスを記述する。  
2. **robots.txt:** サイトマップの場所を明記する。  
3. **リンクの実装:** next-intl の createSharedPathnamesNavigation を使い、常に言語コードが維持される Link コンポーネントを使用する。  
4. **ビルドコマンド:** next build を実行すると out/ ディレクトリに必要な全構造が出力されます。

## ---

**まとめ：この設計のメリット**

* **低コスト:** S3 \+ CloudFront のため、アクセスがない時の費用はほぼゼロ。  
* **高パフォーマンス:** 全ページがエッジ（CloudFront）から配信される。  
* **SEO最適化:** hreflang と trailingSlash により、クローラーにフレンドリー。  
* **シンプル:** インフラ側のロジック（Lambda@Edge等）を極力排除。

この設計書に基づいた実装を開始するにあたって、\*\*「多言語対応の Link コンポーネントを共通化するための navigation.ts の具体的な中身」\*\*について詳しく説明しましょうか？